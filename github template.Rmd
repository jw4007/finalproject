---
title: "Regression Analysis"
output:   
  html_document:
    toc: true
    toc_float: true
---

```{r,include=FALSE,message=FALSE,echo=FALSE}
library(tidyverse)
library(ggplot2)
library(broom)
library(plotly)
library(highcharter)
library(rworldmap)
library(gganimate)
library(transformr)
library(corrplot)
library(leaps)
library(kableExtra)
knitr::opts_chunk$set(
 echo = FALSE,
 fig.width = 7, 
 fig.height = 5,
 fig.asp = 0.6,
 out.width = "60%")
theme_set(theme_bw() + 
          theme(legend.position = "bottom",
                legend.title = element_blank(),
                plot.title = element_text(hjust = 0.5, size = 15),
                plot.subtitle = element_text(hjust = 0.5, size = 12)))


```

### Data Import and Cleaning

#### Death dataset.

```{r}
deaths = read_csv("./data/final_hiv_deaths.csv") %>% 
  janitor::clean_names() %>% 
  select("location_name", starts_with("sex"), starts_with("age"), "year", "val", "upper", "lower") %>% 
  rename(country_name = location_name)

deaths %>% 
  summarize(n_countries = n_distinct(country_name),
            n_years = n_distinct(year))
```

The death dataset comes from:
It contains HIV death count data from 204 distinct countries, in the 30 years between 1990 and 2019.

#### GDP and population datasets.

```{r}
gdp = read_csv("./data/final_gdp_per_capita.csv", skip = 4, col_names = TRUE) %>% 
  pivot_longer(cols = "1960":"2021",
               names_to = "year",
               values_to = "GDP per capita") 

population = read_csv("./data/final_population_total.csv", skip = 4, col_names = TRUE) %>% 
  pivot_longer(cols = "1960":"2021",
               names_to = "year",
               values_to = "Population") 

gdp_population = inner_join(gdp, population, by = c("Country Name", "year")) %>% 
  janitor::clean_names() %>% 
  select("country_name", "year", "gdp_per_capita", "population") %>% 
  mutate(year = as.numeric(year))

gdp_population %>% 
  summarize(n_countries = n_distinct(country_name),
            n_years = n_distinct(year))
```

The GDP and population datasets both come from:
After combining, the gdp_population dataset contains data from 266 distinct countries, in the 62 years between 1960 and 2021.

#### Merging datasets to produce the "maindata" dataset for analysis purpose.

```{r}
maindata = left_join(deaths, gdp_population, by = c("year","country_name"))
```

By matching on the countries and years from the "death" dataset using "left_join", we produced the main dataset. It has a size of `r nrow(maindata)` observations and `r ncol(maindata)` features. Basic features we are interested in include:

- **country_name**: 
- **sex_id**
- **sex_name**
- **age_id**
- **age_name**: Age groups including "0-9 years", "10-24 years",  "25-49 years", "50-74 years", and "75+ years".
- **year**: Year of the records
- **val**: 
- **upper**: 
- **lower**: 
- **gdp_per_capita**:

```{r}

```


```{r}
```


```{r}
```


```{r}
```

